Operaciones Desarrollo


Crear un ambiente de desarrollo

Variables para agilizar

Instala una base sin datos demo

Scafold un modulo

Instala un módulo

Actualizar un módulo

Acceder al contenedor

Detener Odoo

Iniciar Odoo

Ver bases de datos

Eliminar una base de datos

Crear una base de datos vacía

Traducir un módulo

Ver los logs de Odoo

Ver los logs del contenedor

Eliminar los contenedores del proyecto

RESPALDOS DESARROLLO

Restaurar un respaldo en desarrollo

Crear un respaldo en desarrollo

Eliminar archivos dentro del contenedor

RESPALDOS PRODUCCIÓN

Crear un respaldo en producción

Eliminar archivos dentro del contenedor

Restaurar un respaldo en producción





Crear un ambiente de desarrollo

 copier copy gh:Tecnativa/doodba-copier-template ~/proyecto


Variables para agilizar


export CONTAINER=$(docker-compose ps -q odoo)
export BASE_DE_DATOS=emueble
export BACKUP_FILE=emueble_realsystems13_22_03_2022_20_06
export NOMBRE_MODULO=mi_modulo



Instala una base sin datos demo

docker-compose -f devel.yaml run --rm odoo -d ${BASE_DE_DATOS} --without-demo=all --stop-after-init -i base


Scaffold un modulo


docker-compose -f devel.yaml run --rm odoo bash
odoo scaffold ${NOMBRE_MODULO} /var/lib/odoo/filestore/
exit
docker cp ${CONTAINER}:/var/lib/odoo/filestore/${NOMBRE_MODULO} ./odoo/custom/src/private/





Instala un módulo

docker-compose -f devel.yaml run --rm odoo -d ${BASE_DE_DATOS} --stop-after-init -i modulo1,moduloN



Actualizar un módulo

docker-compose -f devel.yaml run --rm odoo -d ${BASE_DE_DATOS} --stop-after-init -u modulo1,moduloN



Acceder al contenedor

docker-compose -f devel.yaml run --rm odoo bash



Detener Odoo

docker-compose -f devel.yaml stop odoo

Iniciar Odoo

docker-compose -f devel.yaml start odoo




Ver bases de datos

docker-compose -f devel.yaml run --rm odoo psql -l



Eliminar una bases de datos

docker-compose -f devel.yaml stop odoo
docker-compose -f devel.yaml run --rm odoo dropdb ${BASE_DE_DATOS}

Crear una bases de datos vacía

docker-compose -f devel.yaml stop odoo
docker-compose -f devel.yaml run --rm odoo createdb ${BASE_DE_DATOS}






Traducir un módulo

docker-compose run --rm odoo -d ${BASE_DE_DATOS} --i18n-export /var/lib/odoo/filestore/es_MX.po --modules my_module

mkdir ./odoo/custom/src/REPOSITORIO/my_module/i18n/

docker cp ${CONTAINER}:/var/lib/odoo/filestore/es_MX.po ./odoo/custom/src/REPOSITORIO/my_module/i18n/
poedit ./odoo/custom/src/REPOSITORIO/my_module/i18n/es_MX.po

Nota:
REPOSITORIO : Es la ruta donde se encuentra el módulo a traducir
my_module: Es el nombre del módulo a traducir


Ver los logs de Odoo

docker-compose -f devel.yaml logs -f --tail 10 odoo



Ver los logs del contenedor

docker-compose -f devel.yaml logs -f --tail 10


Eliminar los contenedores del proyecto

docker-compose -f devel.yaml down -v


RESPALDOS DESARROLLO

Restaurar un respaldo en desarrollo

export CONTAINER=$(docker-compose ps -q odoo)
export BASE_DE_DATOS=emueble
export BACKUP_FILE=emueble_realsystems13_22_03_2022_20_06

docker-compose -f devel.yaml run --rm odoo mkdir -p /var/lib/odoo/filestore
docker cp backups/${BACKUP_FILE}.sql $CONTAINER:/var/lib/odoo/filestore/
docker cp backups/filestore_${BACKUP_FILE}.tar.gz $CONTAINER:/var/lib/odoo/filestore/
docker-compose -f devel.yaml run --rm odoo rm -rf /var/lib/odoo/filestore/${BASE_DE_DATOS}

docker-compose -f devel.yaml run --rm odoo tar zxvf /var/lib/odoo/filestore/filestore_${BACKUP_FILE}.tar.gz --directory=/var/lib/odoo/filestore/
docker-compose -f devel.yaml run --rm odoo mv /var/lib/odoo/filestore/var/lib/odoo/filestore/${BASE_DE_DATOS} /var/lib/odoo/filestore/${BASE_DE_DATOS}
docker-compose -f devel.yaml run --rm odoo rm -rf /var/lib/odoo/filestore/var
docker-compose -f devel.yaml stop odoo
docker-compose -f devel.yaml run --rm odoo dropdb ${BASE_DE_DATOS}
docker-compose -f devel.yaml run --rm odoo psql -l
docker-compose -f devel.yaml run --rm odoo createdb ${BASE_DE_DATOS}
docker-compose -f devel.yaml run --rm odoo psql -d ${BASE_DE_DATOS} -f /var/lib/odoo/filestore/${BACKUP_FILE}.sql
docker-compose -f devel.yaml start odoo


Crear un respaldo en desarrollo
export CONTAINER=$(docker-compose ps -q odoo)
export BASE_DE_DATOS=emueble
export BACKUP_FILE=emueble_realsystems13_22_03_2022_20_06
export DATE_WITH_TIME=`date "+%d_%m_%Y_%H_%M"`
export REMOTE_SERVER=realsystems13

mkdir -p ./backups
docker-compose -f devel.yaml run --rm odoo pg_dump --dbname ${BASE_DE_DATOS} --no-owner --no-privileges --file /var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql ; \
docker-compose -f devel.yaml run --rm odoo tar zcf /var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz /var/lib/odoo/filestore/${BASE_DE_DATOS} ; \
docker cp ${CONTAINER}:/var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz ./backups ; \
docker cp ${CONTAINER}:/var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql ./backups

Eliminar archivos dentro del contenedor:

docker-compose -f devel.yaml run --rm odoo rm /var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz ; \
docker-compose -f devel.yaml run --rm odoo rm /var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql


RESPALDOS PRODUCCIÓN

Crear un respaldo en producción
export CONTAINER=$(docker-compose ps -q odoo)
export BASE_DE_DATOS=emueble
export BACKUP_FILE=emueble_realsystems13_22_03_2022_20_06
export DATE_WITH_TIME=`date "+%d_%m_%Y_%H_%M"`
export REMOTE_SERVER=realsystems13

mkdir -p ./backups
docker-compose -f prod.yaml run --rm odoo pg_dump --dbname ${BASE_DE_DATOS} --no-owner --no-privileges --file /var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql ; \
docker-compose -f prod.yaml run --rm odoo tar zcf /var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz /var/lib/odoo/filestore/${BASE_DE_DATOS} ; \
docker cp ${CONTAINER}:/var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz ./backups ; \
docker cp ${CONTAINER}:/var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql ./backups

Eliminar archivos dentro del contenedor:

docker-compose -f prod.yaml run --rm odoo rm /var/lib/odoo/filestore/filestore_${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.tar.gz ; \
docker-compose -f prod.yaml run --rm odoo rm /var/lib/odoo/filestore/${BASE_DE_DATOS}_${REMOTE_SERVER}_${DATE_WITH_TIME}.sql

Restaurar un respaldo en producción

export CONTAINER=$(docker-compose ps -q odoo)
export BASE_DE_DATOS=emueble
export BACKUP_FILE=emueble_realsystems13_22_03_2022_20_06

docker-compose -f prod.yaml run --rm odoo mkdir -p /var/lib/odoo/filestore
docker cp backups/${BACKUP_FILE}.sql $CONTAINER:/var/lib/odoo/filestore/
docker cp backups/filestore_${BACKUP_FILE}.tar.gz $CONTAINER:/var/lib/odoo/filestore/
docker-compose -f prod.yaml run --rm odoo tar zxvf /var/lib/odoo/filestore/filestore_${BACKUP_FILE}.tar.gz --directory=/var/lib/odoo/filestore/
docker-compose -f prod.yaml run --rm odoo mv /var/lib/odoo/filestore/var/lib/odoo/filestore/${BASE_DE_DATOS} /var/lib/odoo/filestore/${BASE_DE_DATOS}
docker-compose -f prod.yaml run --rm odoo rm -rf /var/lib/odoo/filestore/var
docker-compose -f prod.yaml stop odoo
docker-compose -f prod.yaml run --rm odoo dropdb ${BASE_DE_DATOS}
docker-compose -f prod.yaml run --rm odoo psql -l
docker-compose -f prod.yaml run --rm odoo createdb ${BASE_DE_DATOS}
docker-compose -f prod.yaml run --rm odoo psql -d ${BASE_DE_DATOS} -f /var/lib/odoo/filestore/${BACKUP_FILE}.sql
docker-compose -f prod.yaml start odoo
